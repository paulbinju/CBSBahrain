<script src="@Url.Content("~/assets/js/jquery.min.js")"></script>
<div class="content-page">
    <!-- Start content -->
    <div class="content">

        <div class="container">
            @foreach (var b in ViewBag.Vehicle)
            {             <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-primary">
                        <div class="panel-body">

                            <div class="col-md-3">
                                <h4>Job Card No. @b.JobCardID</h4>
                                Start Date:  @b.JobStarted.ToString("dd-MMM-yyyy")<br />
                                End Date:  @(b.JobEnded==null?"": b.JobEnded.ToString("dd-MMM-yyyy"))
                            </div>

                            <div class="col-md-3">
                                  <h4>Registration No.: @b.RegistrationNo</h4>
                                    <span>@b.VehicleNoName</span>
                                 
                            </div>
                            <div class="col-md-3">
                                <h4>Labour Hours: @b.LabourHours</h4>
                                <h4>Total Cost: @Session["Currency"] @b.TotalCost</h4>
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-primary" onclick="sparepartclicked()" data-toggle="modal" href="#InvoiceModal"><i class="icofont icofont-ui-add"></i>Add Job Card Details</button>
                                <a class="btn btn-success" href="@Url.Content("~/JobCard")" ><i class="icofont icofont-ui-add"></i>< Back</a>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            }

        </div>

        <div class="page-content-wrapper ">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-primary">
                            <div class="panel-body">
                                <div class="dt-responsive table-responsive">
                                    <table id="table-style-hover" class="table table-striped table-hover table-bordered nowrap">
                                        <thead>
                                            <tr>
                                                <th>Type</th>

                                                <th>
                                                    Description
                                                </th>
                                                <th>
                                                    Quantity / Description
                                                </th>
                                                <th style="text-align:right">
                                                    Amount (@Session["Currency"])
                                                </th>
                                                <th>Modify</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var bd in ViewBag.JobCardDetails)
                                            {
                                                <tr>
                                                    <td>
                                                        @(bd.SparePart == true ? "Spare Part" : "Service")
                                                    </td>

                                                    <td>
                                                        @bd.Descri
                                                    </td>
                                                    <td>
                                                        @bd.Quantity
                                                    </td>
                                                    <td style="text-align:right">
                                                        @bd.Amount
                                                    </td>


                                                    <td>
                                                        <a class="pcoded-badge label label-danger" href="@Url.Content("~/SpareServiceDetails/Deleteinvdetsxx/" + bd.SpareServiceDetailsID+"/jobcard")"><i class="fa fa-time"></i> Delete</a>
                                                    </td>
                                                </tr>


                                            }
                                        </tbody>

                                    </table>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade modal-dialog-center" id="InvoiceModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content-wrap">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Add JobCard Detail Item</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                </div>

                <script>


                    function serviceclicked() {
                        $("#grpservice,#grplabourhours,#grpnote").show().find(':input').attr('required', true);
                        $("#grpspareparts,#grpamount,#grpquantity").hide().find(':input').attr('required', false);
                    }

                    function sparepartclicked() {
                        $("#grpservice,#grplabourhours,#grpnote").hide().find(':input').attr('required', false);
                        $("#grpspareparts,#grpamount,#grpquantity").show().find(':input').attr('required', true);
                    }
                </script>

                <div class="modal-body">

                    <div class="form-horizontal col-md-12">
                        @using (Html.BeginForm("Create", "SpareServiceDetails"))
                        {
                            <input type="hidden" name="JobCardID" value="@ViewBag.JobCardID" />
                            <input type="hidden" name="VehicleID" value="@ViewBag.Vehicle[0].VehicleID" />
                            <input type="hidden" name="BillID" value="-1" />


                            <div class="form-group">
                                <div class="col-md-12">
                                    <input type="radio" name="SparePart" value="true" checked onclick="sparepartclicked()" /> Spare Parts &nbsp;&nbsp;&nbsp;<input type="radio" value="false" name="SparePart" onclick="serviceclicked()" /> Service
                                </div>
                            </div>

                            <div class="form-group" id="grpservice">
                                <div class="col-md-12">
                                    Service<br />
                                    <select class="form-control" name="ServiceID">
                                        @foreach (var ser in ViewBag.Service)
                                        {
                                            <option value="@ser.ServiceID">@ser.ServiceName</option>
                                        }
                                    </select>
                                </div>
                            </div>

                            <div class="form-group" id="grpspareparts">
                                <div class="col-md-12">
                                    Spare Parts<br />
                                    <select class="form-control" name="SparePartID">
                                        @foreach (var sp in ViewBag.SparePart)
                                        {
                                            <option value="@sp.SparePartID">@sp.Code - @sp.Description (Available Qty: @sp.AvailableQuantity / Price:@Session["Currency"] @sp.Price)</option>
                                        }
                                    </select>
                                </div>
                            </div>


                            <div class="form-group" id="grpquantity">

                                <div class="col-md-12">
                                    Quantity<br />
                                    <input type="number" class="form-control" name="Quantity" required />
                                </div>
                            </div>

                            <div class="form-group" id="grpnote">

                                <div class="col-md-12">
                                    Note<br />
                                    <input type="text" class="form-control" name="Quantity2" required />
                                </div>
                            </div>
                            <div class="form-group" id="grpamount">

                                <div class="col-md-12">
                                    Amount (@Session["Currency"])<br />
                                    <input type="number" step="any" class="form-control" name="Amount" required />
                                </div>
                            </div>
                            <div class="form-group" id="grplabourhours">

                                <div class="col-md-12">
                                    Labour Hours<br />
                                    <input type="number" step="any" class="form-control" name="labourhour" required />
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input type="submit" value="Create" class="btn btn-danger" />
                                </div>
                            </div>
                        }
                    </div>


                </div>
                <br style="clear:both" />
                <div class="modal-footer">

                </div>

            </div>
        </div>
    </div>
</div>


<script>
        $(document).ready(function () {


          //  getservicepart();
            $("#servicepartaddrow").hide();

            $("#btnspsave").click(function () {
                $.getJSON('@Url.Content("~/App/Addservicepart/")' + $("#ServicePartName").val() + '/?jsoncallback=?', function (data) {
                }).done(function () {
                    getservicepart();
                    $("#servicepartaddrow").hide();
                });
            });
        });
        function getservicepart() {
            $.getJSON('@Url.Content("~/App/getservicepart/?jsoncallback=?")', function (data) {
                var content = "";
                $("#ServicePartID").empty();
                $.each(data, function (key, value) {
                    $("#ServicePartID").append("<option value='" + data[key].ServicePartsID + "'>" + data[key].ServicePartName + "</option>");
                });
            });
        }
        function showadd() {
            $("#servicepartaddrow").show();

        }

        

</script>
<script src="@Url.Content("~/assets/js/bootstrap.min.js")"></script>
<script src="@Url.Content("~/assets/js/modernizr.min.js")"></script>
<script src="@Url.Content("~/assets/js/detect.js")"></script>
<script src="@Url.Content("~/assets/js/fastclick.js")"></script>
<script src="@Url.Content("~/assets/js/jquery.slimscroll.js")"></script>
<script src="@Url.Content("~/assets/js/jquery.blockUI.js")"></script>
<script src="@Url.Content("~/assets/js/waves.js")"></script>
<script src="@Url.Content("~/assets/js/wow.min.js")"></script>
<script src="@Url.Content("~/assets/js/jquery.nicescroll.js")"></script>
<script src="@Url.Content("~/assets/js/jquery.scrollTo.min.js")"></script>
<script src="@Url.Content("~/assets/js/app.js")"></script>

